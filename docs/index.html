<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>TinyMLâ€‘DigitRecognizer Â· Playground</title>
  <meta name="description" content="å¾ Python è¨“ç·´åˆ° C æ¨è«–çš„ TinyML æ•¸å­—è¾¨è­˜å°ˆæ¡ˆï¼šäº’å‹•å±•ç¤ºã€æ¨£æœ¬è¼‰å…¥ã€8Ã—8 ç·¨è¼¯èˆ‡åŒ¯å‡ºã€‚" />
  <meta name="theme-color" content="#7aa2f7" />
  <!--
    ä½¿ç”¨æ–¹å¼ï¼š
    1) å°‡æœ¬æª”æ¡ˆç›´æ¥è¦†è“‹åˆ°æ‚¨çš„ repo çš„ docs/index.htmlã€‚
    2) æœ¬é é¢è‡ªå¸¶ CSS/JSï¼Œç„¡éœ€å…¶ä»–æª”æ¡ˆå³å¯åŸ·è¡Œï¼›åŒæ™‚ä»èƒ½è¼‰å…¥ ../samples/*.txtã€‚
    3) å¦‚è¦æ”¹å›åˆ†é›¢å¼æª”æ¡ˆï¼ˆstyle.css / app.jsï¼‰ï¼Œæˆ‘å¯ä»¥å†çµ¦å°æ‡‰ç‰ˆæœ¬ã€‚
  -->
  <style>
    :root{
      --bg:#0b0e14; --fg:#e6e1cf; --muted:#a6accd; --brand:#7aa2f7; --panel:#11151f; --border:#1f2430; --accent:#8bd5ca;
      --ok:#22c55e; --warn:#f59e0b; --err:#ef4444; --shadow:0 12px 28px rgba(0,0,0,.35); --radius:16px;
    }
    @media (prefers-color-scheme: light){
      :root{ --bg:#f6f8fb; --fg:#111827; --muted:#5b6472; --panel:#ffffff; --border:#e5e7eb; --accent:#10b981; --brand:#2563eb; --shadow:0 12px 28px rgba(2,6,23,.08) }
    }
    *{box-sizing:border-box}
    html,body{margin:0;padding:0;background:var(--bg);color:var(--fg);font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,"Apple Color Emoji","Segoe UI Emoji";line-height:1.6}
    a{color:var(--brand);text-decoration:none} a:hover{text-decoration:underline}
    .container{max-width:1000px;margin:0 auto;padding:24px}
    header{position:sticky;top:0;z-index:50;backdrop-filter:saturate(180%) blur(8px);background:color-mix(in oklab, var(--bg) 82%, transparent);border-bottom:1px solid color-mix(in oklab,var(--fg) 12%, transparent)}
    .h-inner{display:flex;align-items:center;justify-content:space-between;gap:12px;max-width:1060px;margin:0 auto;padding:14px 20px}
    .title{display:flex;align-items:center;gap:10px;font-weight:800}
    .subtitle{color:var(--muted);font-size:14px}
    .actions{display:flex;gap:10px;flex-wrap:wrap}
    .btn{display:inline-flex;align-items:center;gap:8px;padding:10px 14px;border:1px solid var(--border);border-radius:12px;background:linear-gradient(180deg,#121826,#0e1420);box-shadow:var(--shadow)}
    .btn:hover{border-color:var(--brand);box-shadow:0 0 0 2px #1a2333 inset,var(--shadow);transform:translateY(-1px)}
    .pill{display:inline-flex;align-items:center;gap:6px;padding:6px 10px;border-radius:999px;background:color-mix(in oklab,var(--accent) 16%, transparent);border:1px solid color-mix(in oklab,var(--accent) 36%, transparent)}
    .panel{background:var(--panel);border:1px solid var(--border);border-radius:var(--radius);padding:20px;margin:18px 0;box-shadow:var(--shadow)}
    .panel h2{margin-top:0}
    .grid-2{display:grid;grid-template-columns:1.1fr .9fr;gap:18px}
    @media (max-width:860px){.grid-2{grid-template-columns:1fr}}
    .picker{display:grid;grid-template-columns:repeat(10,1fr);gap:8px;margin:12px 0 16px}
    .picker button{padding:10px 0;background:#0f1623;color:var(--fg);border:1px solid var(--border);border-radius:10px;cursor:pointer}
    .picker button.active{outline:2px solid var(--accent);border-color:var(--accent)}
    .grid{width:320px;height:320px;display:grid;grid-template-columns:repeat(8,1fr);grid-template-rows:repeat(8,1fr);background:#0f1623;border:1px solid var(--border);border-radius:8px;overflow:hidden}
    .cell{border:1px solid #151b28;transition:background-color .08s ease}
    .raw{background:#0f1623;border:1px solid var(--border);border-radius:8px;padding:10px;min-height:320px;overflow:auto}
    .toolbar{display:flex;flex-wrap:wrap;gap:8px;margin:10px 0}
    .input,select{background:#0f1623;border:1px solid var(--border);color:var(--fg);padding:8px 10px;border-radius:10px}
    .note{color:var(--muted)}
    .footer{display:flex;justify-content:space-between;gap:12px;flex-wrap:wrap;color:var(--muted);font-size:14px}
    .dropzone{display:flex;align-items:center;justify-content:center;min-height:60px;border:1px dashed color-mix(in oklab,var(--fg) 26%, transparent);border-radius:12px;padding:10px;color:var(--muted)}
    .toggle{cursor:pointer}
    .kbd{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono";background:#0f1623;border:1px solid var(--border);border-radius:6px;padding:2px 6px}
    @media (max-width:760px){.grid{width:100%;height:auto;aspect-ratio:1/1}}
  </style>
</head>
<body>
  <header>
    <div class="h-inner">
      <div class="title">ğŸ”¢ TinyMLâ€‘DigitRecognizer <span class="subtitle">Train in Python Â· <span class="pill">Infer in C</span> Â· Run on constrained devices</span></div>
      <nav class="actions">
        <a class="btn" href="https://github.com/WuPinLiang/TinyML-DigitRecognizer" target="_blank" rel="noopener">GitHub</a>
        <a class="btn" href="https://colab.research.google.com/github/WuPinLiang/TinyML-DigitRecognizer/blob/main/notebooks/MicroProcessor.ipynb" target="_blank" rel="noopener">Open in Colab</a>
        <button id="themeBtn" class="btn toggle" title="åˆ‡æ›ä¸»é¡Œ">Theme</button>
      </nav>
    </div>
  </header>

  <main class="container">
    <section class="panel">
      <h2>è©¦ç© 8Ã—8 æ¨£æœ¬</h2>
      <p>å¾ repository è¼‰å…¥ <code>../samples/&lt;digit&gt;.txt</code>ï¼Œæˆ–æ‹–æ‹‰æœ¬æ©Ÿæª”æ¡ˆåˆ°ä¸‹æ–¹å€åŸŸã€‚ä½ ä¹Ÿå¯ä»¥åœ¨å³å´ç›´æ¥ç·¨è¼¯ 8Ã—8 ç¶²æ ¼ä¸¦åŒ¯å‡ºç´”æ–‡å­—ã€‚</p>

      <div class="picker" id="digitButtons"></div>

      <div class="grid-2">
        <!-- Left: sample viewer -->
        <div>
          <h3>Bitmap Gridï¼ˆæª¢è¦–/ç¹ªè£½ï¼‰</h3>
          <div class="toolbar">
            <label>é¡¯ç¤ºæ¨¡å¼ï¼š
              <select id="vizMode">
                <option value="binary">äºŒå€¼ï¼ˆ0/1ï¼‰</option>
                <option value="heat">å¼·åº¦ï¼ˆ0â€“255 æ¼¸å±¤ï¼‰</option>
              </select>
            </label>
            <label>é–¾å€¼ï¼ˆfor äºŒå€¼ï¼‰ï¼š
              <input type="range" id="thresh" min="1" max="254" value="128" />
              <span id="threshVal" class="kbd">128</span>
            </label>
            <button class="btn" id="clearBtn">Clear</button>
            <button class="btn" id="invertBtn">Invert</button>
            <button class="btn" id="randomBtn">Random</button>
            <button class="btn" id="copyBtn">Copy Text</button>
            <button class="btn" id="downloadBtn">Download .txt</button>
          </div>
          <div id="grid" class="grid" aria-label="8x8 å¯ç·¨è¼¯ç¶²æ ¼" role="grid"></div>
          <p class="note">å°æŠ€å·§ï¼šæŒ‰ä½ <span class="kbd">Shift</span> å¯æŒçºŒå¡—æŠ¹ï¼›æŒ‰ä½ <span class="kbd">Alt/Option</span> åå‘å¡—æŠ¹ã€‚</p>
        </div>

        <!-- Right: raw text + dropzone -->
        <div>
          <h3>Raw Text</h3>
          <pre id="raw" class="raw">ï¼ˆå¾å·¦å´è¼‰å…¥æˆ–åœ¨ç¶²æ ¼ä¸Šç¹ªè£½å¾Œï¼Œé€™è£¡æœƒé¡¯ç¤º 64 å€‹æ•¸å­—ï¼‰</pre>
          <div id="drop" class="dropzone">æ‹–æ”¾ <code>.txt</code> æª”æ¡ˆåˆ°é€™è£¡ä»¥è¼‰å…¥ï¼ˆæ¥å— 8 è¡Œ Ã— 8 åˆ—æˆ– 64 å€‹æ•¸å­—ï¼‰</div>
        </div>
      </div>

      <p class="note">é€™å€‹é é¢<strong>ä¸åœ¨ç€è¦½å™¨åšæ¨è«–</strong>ï¼›å¦‚è¦åœ¨ C ç«¯è·‘ demoï¼š</p>
      <pre class="raw">make && ./build/demo samples/3.txt</pre>
    </section>

    <section class="panel">
      <h2>About</h2>
      <p>é€™å€‹å°ˆæ¡ˆå±•ç¤ºå¦‚ä½•å°‡åœ¨ Python/Colab è¨“ç·´çš„å°å‹ NNï¼ˆä¾‹å¦‚ï¼šFC(64â†’H) + ReLU â†’ FC(Hâ†’10)ï¼‰çš„æ¬Šé‡ï¼Œè½‰æ›ç‚º C é™£åˆ—ä¸¦åœ¨è³‡æºå—é™è£ç½®æ¨è«–ã€‚</p>
      <ul>
        <li><strong>Trainingï¼š</strong><code>notebooks/MicroProcessor.ipynb</code></li>
        <li><strong>Raw weightsï¼š</strong><code>weights_raw/</code>ï¼ˆHidden/Output çš„ Weights & Biasï¼‰</li>
        <li><strong>C arraysï¼š</strong><code>weights/weights.c</code>ã€<code>weights/weights.h</code></li>
        <li><strong>Inference codeï¼š</strong><code>src/</code>ã€<code>include/</code></li>
        <li><strong>Samplesï¼š</strong><code>samples/</code>ï¼ˆ8Ã—8 ç´”æ–‡å­—ï¼‰</li>
      </ul>
    </section>

    <section class="panel">
      <h2>ä¸‹ä¸€æ­¥</h2>
      <ul>
        <li>ğŸ§® é‡åŒ–/å‰ªæï¼š8â€‘bit é‡åŒ–ã€ç¨€ç–åŒ–ã€å¸¸æ•¸æŠ˜ç–Šã€‚</li>
        <li>ğŸš€ æ•ˆèƒ½ï¼šå¿«å–å‹å–„é™£åˆ—ã€è¿´åœˆå±•é–‹ã€SIMDï¼ˆè‹¥ç¡¬é«”æ”¯æ´ï¼‰ã€‚</li>
        <li>ğŸ§± éƒ¨ç½²ï¼šè½‰ WebAssembly åœ¨é é¢åšæ¨è«–ã€æˆ–ç”¢ç”Ÿ CMSISâ€‘NN / TFLM ç‰ˆæœ¬ã€‚</li>
      </ul>
    </section>
  </main>

  <footer class="container footer">
    <span>MIT Licensed</span>
    <span>Â© 2025 TinyMLâ€‘DigitRecognizer</span>
  </footer>

  <script>
    // ===== Utilities =====
    const $ = (sel, el=document) => el.querySelector(sel);
    const $$ = (sel, el=document) => Array.from(el.querySelectorAll(sel));
    const clamp = (v, lo, hi) => Math.max(lo, Math.min(hi, v));

    // Theme toggle (persist in localStorage)
    const themeBtn = $('#themeBtn');
    const THEME_KEY = 'tdr-theme';
    function setTheme(mode){
      document.documentElement.dataset.theme = mode;
      localStorage.setItem(THEME_KEY, mode);
    }
    (function(){
      const saved = localStorage.getItem(THEME_KEY);
      if(saved) setTheme(saved);
      themeBtn.addEventListener('click', ()=>{
        const cur = document.documentElement.dataset.theme || 'auto';
        setTheme(cur === 'light' ? 'dark' : cur === 'dark' ? 'auto' : 'light');
        themeBtn.textContent = 'Theme: ' + (document.documentElement.dataset.theme||'auto');
      });
      themeBtn.textContent = 'Theme: ' + (document.documentElement.dataset.theme||'auto');
    })();

    // ===== 8x8 Board State =====
    // ä»¥ 0..255 çš„å¼·åº¦è¡¨ç¤ºï¼›binary æ¨¡å¼ä¸‹ç”¨ threshold æ±ºå®š on/off
    let values = new Array(64).fill(0);
    const grid = $('#grid');
    const raw = $('#raw');
    const vizMode = $('#vizMode');
    const thresh = $('#thresh');
    const threshVal = $('#threshVal');

    function renderGrid(){
      grid.innerHTML = '';
      values.forEach((val, idx)=>{
        const d = document.createElement('div');
        d.className = 'cell';
        // è¦–è¦ºï¼šäºŒå€¼æˆ–æ¼¸å±¤
        const v = clamp(Number(val)||0, 0, 255);
        if(vizMode.value === 'binary'){
          d.style.background = (v >= Number(thresh.value)) ? 'var(--accent)' : 'transparent';
        }else{
          d.style.background = `color-mix(in oklab, var(--accent) ${v/255*100}%, transparent)`;
        }
        d.setAttribute('role','gridcell');
        d.setAttribute('aria-label', `r${Math.floor(idx/8)+1}c${idx%8+1}`);
        grid.appendChild(d);
      });
    }

    function renderRaw(){
      // ä»¥ 8 è¡Œ Ã— 8 åˆ—è¼¸å‡ºï¼›ä¿æŒåŸå€¼ 0..255
      let out = '';
      for(let r=0;r<8;r++){
        const row = values.slice(r*8, r*8+8).map(x=>String(clamp(Number(x)||0,0,255))).join(' ');
        out += row + (r<7?'\n':'');
      }
      raw.textContent = out;
    }

    function sync(){ renderGrid(); renderRaw(); }

    // åˆå§‹å»ºç«‹ cell + ç¹ªåœ–äº’å‹•
    let drawing = false; let drawTo = 255; // ç›®æ¨™å€¼
    function updateCellAtEvent(e, forceValue){
      const rect = grid.getBoundingClientRect();
      const size = rect.width; // å› ç‚ºæ˜¯æ­£æ–¹å½¢
      const cellW = size / 8; const cellH = (rect.height) / 8;
      const x = clamp(Math.floor((e.clientX - rect.left) / cellW), 0, 7);
      const y = clamp(Math.floor((e.clientY - rect.top) / cellH), 0, 7);
      const i = y*8 + x;
      const alt = e.altKey || e.metaKey; // åå‘
      const val = (typeof forceValue === 'number') ? forceValue : (alt ? 0 : drawTo);
      values[i] = val;
      sync();
    }

    grid.addEventListener('pointerdown', e=>{ drawing = true; grid.setPointerCapture(e.pointerId); updateCellAtEvent(e); });
    grid.addEventListener('pointermove', e=>{ if(drawing || e.shiftKey) updateCellAtEvent(e); });
    grid.addEventListener('pointerup', e=>{ drawing = false; });
    grid.addEventListener('pointerleave', ()=>{ drawing = false; });

    // æ§åˆ¶é …
    thresh.addEventListener('input', ()=>{ threshVal.textContent = thresh.value; renderGrid(); });
    vizMode.addEventListener('change', renderGrid);
    $('#clearBtn').addEventListener('click', ()=>{ values.fill(0); sync(); });
    $('#invertBtn').addEventListener('click', ()=>{ values = values.map(v=>255 - (Number(v)||0)); sync(); });
    $('#randomBtn').addEventListener('click', ()=>{ values = values.map(()=> Math.random()<0.5 ? 0 : 255); sync(); });
    $('#copyBtn').addEventListener('click', async ()=>{ try{ await navigator.clipboard.writeText(raw.textContent); }catch{} });
    $('#downloadBtn').addEventListener('click', ()=>{
      const blob = new Blob([raw.textContent], {type:'text/plain'});
      const a = document.createElement('a');
      a.href = URL.createObjectURL(blob); a.download = 'digit_8x8.txt'; a.click(); URL.revokeObjectURL(a.href);
    });

    // æ•¸å­—æŒ‰éˆ•èˆ‡æ¨£æœ¬è¼‰å…¥
    const digitButtons = $('#digitButtons');
    for(let d=0; d<=9; d++){
      const b = document.createElement('button');
      b.textContent = d; b.className = 'btn';
      b.addEventListener('click', ()=> loadSample(d));
      digitButtons.appendChild(b);
    }

    async function fetchWithFallback(path){
      // å…ˆè©¦ docs/ ç›¸å°çš„ ../samplesï¼Œå†è©¦ ./samples
      const tries = [path, path.replace('../','./')];
      for(const url of tries){
        try{
          const res = await fetch(url, {cache:'no-store'});
          if(res.ok) return await res.text();
        }catch(e){ /* ignore and try next */ }
      }
      throw new Error('not found');
    }

    async function loadSample(d){
      // å˜—è©¦è¼‰å…¥æ•¸å­—æ¨£æœ¬
      try{
        const txt = await fetchWithFallback(`../samples/${d}.txt`);
        const nums = txt.trim().split(/\s+|,|\n/).map(Number).filter(n=>!Number.isNaN(n));
        let vals = [];
        if(nums.length===64){ vals = nums; }
        else {
          const lines = txt.trim().split(/\n/).map(s=>s.trim()).filter(Boolean);
          for(const line of lines){
            const row = line.split(/\s+|,/).map(Number).filter(n=>!Number.isNaN(n));
            vals.push(...row);
          }
        }
        while(vals.length<64) vals.push(0);
        values = vals.slice(0,64).map(v=> clamp(Number(v)||0, 0, 255));
        // é è¨­äºŒå€¼è¦–è¦ºé¡¯ç¤º
        vizMode.value = 'binary';
        sync();
        // é«˜äº®ç•¶å‰æŒ‰éˆ•
        $$('#digitButtons .btn').forEach((el,i)=> el.classList.toggle('active', i===Number(d)) );
      }catch(err){
        raw.textContent = `âš ï¸ æ‰¾ä¸åˆ° samples/${d}.txtã€‚è«‹ç¢ºèªæª”æ¡ˆå­˜åœ¨ repoï¼ˆdocs/ ç›¸å°è·¯å¾‘æ‡‰ç‚º ../samples/${d}.txtï¼‰ã€‚`;
      }
    }

    // æ‹–æ”¾è¼‰å…¥
    const drop = $('#drop');
    ;['dragenter','dragover'].forEach(ev=> drop.addEventListener(ev, e=>{ e.preventDefault(); drop.style.background = 'color-mix(in oklab, var(--accent) 12%, transparent)'; }));
    ;['dragleave','drop'].forEach(ev=> drop.addEventListener(ev, e=>{ e.preventDefault(); drop.style.background = 'transparent'; }));
    drop.addEventListener('drop', e=>{
      const file = e.dataTransfer.files?.[0];
      if(!file) return;
      const reader = new FileReader();
      reader.onload = ()=>{
        try{
          const txt = String(reader.result||'');
          const nums = txt.trim().split(/\s+|,|\n/).map(Number).filter(n=>!Number.isNaN(n));
          let vals = [];
          if(nums.length===64){ vals = nums; }
          else{
            const lines = txt.trim().split(/\n/).map(s=>s.trim()).filter(Boolean);
            for(const line of lines){
              const row = line.split(/\s+|,/).map(Number).filter(n=>!Number.isNaN(n));
              vals.push(...row);
            }
          }
          while(vals.length<64) vals.push(0);
          values = vals.slice(0,64).map(v=> clamp(Number(v)||0, 0, 255));
          sync();
        }catch(err){ raw.textContent = 'âš ï¸ æª”æ¡ˆæ ¼å¼ç„¡æ³•è§£æã€‚è«‹æä¾› 64 å€‹æ•¸å­—æˆ– 8 è¡Œ Ã— 8 åˆ—æ•¸å­—ã€‚'; }
      };
      reader.readAsText(file);
    });

    // åˆå§‹åŒ–
    sync();
  </script>
</body>
</html>
